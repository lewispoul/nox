# E2E-005: End-to-End API Test

Exercises public API in one flow: create job → poll → fetch artifacts.

**Key choices**
- Uses `httpx.ASGITransport` → no live server.
- Defaults to local/threading mode; set `REDIS_URL` to use Redis-backed workers.
- Accepts both legacy (`done`) and new (`completed`) states.

**Run**
```bash
pytest tests/e2e -q
```

## Hermetic test mode

Set `JOBS_FORCE_LOCAL=1` in the environment (or via `monkeypatch.setenv` in tests) to force the API to run jobs in local thread mode instead of enqueuing to Redis/Dramatiq.

If you want to stub XTB execution in unit tests, use `api.services.queue.set_xtb_runner(my_stub)` to inject a callable that accepts the job payload and returns a result dict.
